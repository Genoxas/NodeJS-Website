<html>
	<head>
		<title>Ordering System</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light" style="margin-bottom: 10px">
				<a class="navbar-brand" href="#">Ordering System</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					  </button>
					  <div class="collapse navbar-collapse" id="navbarSupportedContent"> 	
							<form class="form-inline my-2 my-lg-0">
									<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
									<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
								  </form>
								</div>  
		</nav>
		<div id="content" style="padding-left: 5%;padding-right:5%;">
			<h1 style="text-align: center;">Orders</h1>
		<table class="table table-bordered table-hover">
			<thead class="thead-dark" style="background-color: darkgrey;">
				<tr>
					<td>Order Id</td>
					<td>Name</td>
					<td>Phone Number</td>
					<td>Items</td>	
				</tr>
			</thead>
			<tbody id="tablebody">
			</tbody>
		</table>
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>

	<!-- Add Firebase products that you want to use -->
	<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-database.js"></script>
	<script>
			var config = {
				apiKey: "AIzaSyCoRXZJEffOERvO85-vcM-AGdpO-f7Y88g",
  				authDomain: "tatilliaordering.firebaseapp.com",
  				databaseURL: "https://tatilliaordering.firebaseio.com",
  				projectId: "tatilliaordering",
  				storageBucket: "tatilliaordering.appspot.com",
  				messagingSenderId: "430832741787",
  				appId: "1:430832741787:web:b79e74f89af49ac4"
			};
	
			firebase.initializeApp(config);
	
			var database = firebase.database();
			var order = firebase.database().ref('/');
			order.on('value', function(snapshot){
				var menuList = snapshot.val()["Menu"];
				var orderList = snapshot.val()["Orders"];
				UpdateTable(menuList, orderList);
			});

			function UpdateTable(menuList, OrderList)
			{
				//console.log(OrderList);
				var orderTableBody = document.getElementById('tablebody');
				while (orderTableBody.firstChild){ orderTableBody.removeChild(orderTableBody.firstChild);}

				for (i = 1; i < OrderList.length; i++)
				{
					var node = getOrderData(OrderList[i], i, menuList);
					orderTableBody.appendChild(node);	
				}
			};

			function getOrderData(orderData, id, menuList)
			{
				var trNode = document.createElement("tr");
				var tdNode = document.createElement("td");
				tdNode.appendChild(document.createTextNode(id));
				trNode.appendChild(tdNode);

				tdNode = document.createElement("td");
				tdNode.appendChild(document.createTextNode(orderData["Name"]))
				trNode.appendChild(tdNode);
				tdNode = document.createElement("td");
				tdNode.appendChild(document.createTextNode(orderData["PhoneNumber"]))
				trNode.appendChild(tdNode);
				tdNode = document.createElement("td");
				var itemsOrdered = orderData["Items"];
				ulNode = document.createElement("ul");
				
				//console.log(menuList);

				for (j = 1; j < itemsOrdered.length;j++)
				{
					liNode = document.createElement("li");
					var description = menuList[itemsOrdered[j]["MenuId"]]["Description"];
					var text = itemsOrdered[j]["Qty"] + " x " + description;
					liNode.appendChild(document.createTextNode(text));
					ulNode.appendChild(liNode);
				}
				tdNode.appendChild(ulNode)
				trNode.appendChild(tdNode);
				return trNode;
			}

			function placeOrder()
			{
				var orderCounter = 0;
				var menuList;
				var oc = firebase.database().ref('Counters/OrderCounter');
				var menu = firebase.database().ref('MenuList');
				oc.once('value', function(snapshot){
					orderCounter = snapshot.val();
				});
				menu.once('value', function(snapshot){
					menuList = snapshot.val();
				});
				orderCounter++;
				var selectedItem = document.getElementById("itemSelection").value;
				var selectedQty = document.getElementById("itemQuantity").value;
				var name = document.getElementById("name").value;
				var phoneNumber = document.getElementById("phonenumber").value;
				
				firebase.database().ref('Orders/' + orderCounter).set({
					"Name": name,
					"PhoneNumber": phoneNumber,
					"Items": {"1" : { "MenuId": selectedItem, "Qty": selectedQty}}
				}); 
				firebase.database().ref('Counters/OrderCounter').set(orderCounter);
				alert("Order Placed.");
			}

		</script>

	</body>
	
</html>